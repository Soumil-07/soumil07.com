<section id="timeline" class="w-full max-w-3xl mx-auto mt-16">
  <h2 class="text-3xl font-bold mb-8">Timeline</h2>

  <div class="flex gap-8 items-start">
    <div class="shrink-0 sticky top-28">
      <div class="text-sm font-medium text-gray-300 mb-3">Years</div>
      <div id="timeline-year-column" class="flex flex-col gap-3 text-sm"></div>
    </div>

    <div
      id="timeline-list"
      class="relative border-l border-zinc-600 pl-6 space-y-10 max-h-[70vh] overflow-y-auto pr-4 flex-1"
    >
      {% for item in timeline %}
        <article class="relative timeline-item" data-year="{{ item.year }}">
          <p class="text-sm uppercase tracking-wide text-gray-400">{{ item.date }}</p>
          <h3 class="text-xl font-semibold mt-1">{{ item.title }}</h3>
          {% if item.location %}
            <p class="text-sm text-gray-400">{{ item.location }}</p>
          {% endif %}

          {% if item.image %}
            <div class="mt-3">
              <img
                src="{{ item.image }}"
                alt="{{ item.imageAlt or item.title }}"
                class="rounded-lg border border-zinc-700 max-h-56 object-cover"
              >
            </div>
          {% endif %}

          {% if item.description %}
            <p class="mt-3 text-gray-300 leading-relaxed">
              {{ item.description }}
            </p>
          {% endif %}
        </article>
      {% endfor %}
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const yearColumn = document.getElementById('timeline-year-column');
      const buttons = () => Array.from(document.querySelectorAll('#timeline-year-column .timeline-year-btn'));
      const items = Array.from(document.querySelectorAll('#timeline-list .timeline-item'));

      // Collect unique years from data-year attributes
      const years = Array.from(new Set(items.map((item) => item.dataset.year).filter(Boolean))).sort().reverse();

      years.forEach((year) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'timeline-year-btn text-left text-10xl text-gray-400 hover:text-white transition-colors';
        btn.dataset.year = year;
        btn.textContent = year;
        yearColumn.appendChild(btn);
      });

      function applyFilter(selectedYear) {
        buttons().forEach((btn) => {
          const isActive = btn.dataset.year === selectedYear;
          if (isActive) {
            btn.className = 'timeline-year-btn text-left text-white font-semibold';
          } else {
            btn.className = 'timeline-year-btn text-left text-gray-400 hover:text-white transition-colors';
          }
        });

        items.forEach((item) => {
          const match = item.dataset.year === selectedYear;
          item.style.display = match ? '' : 'none';
        });
      }

      yearColumn.addEventListener('click', (event) => {
        const target = event.target.closest('.timeline-year-btn');
        if (!target) return;
        applyFilter(target.dataset.year);
      });

      // Initial state: latest year active (years are sorted desc)
      if (years.length > 0) {
        applyFilter(years[0]);
      }
    });
  </script>
</section>
